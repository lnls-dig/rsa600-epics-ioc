#---------------------------------------------------------------------
# Title      : Tektronix RSA600 Spectrum Analyzer Epics Database File
# Project    :
#---------------------------------------------------------------------
# File       : rsa.db
# Author     : Jo√£o Leandro de Brito Neto
# Company    : Brazilian Synchrotron Light Laboratory, LNLS/CNPEM
#---------------------------------------------------------------------
# Copyright (c) 2018 Brazilian Synchrotron Light Laboratory, LNLS/CNPEM
#
# This program is free software: you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public License
# as published by the Free Software Foundation, either version 3 of
# the License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this program. If not, see
# <http://www.gnu.org/licenses/>.
#---------------------------------------------------------------------
# Revisions  :
# Date          Version         Author                  Description
# 2018-jun-11                   leticiagcapovilla       Updated
#---------------------------------------------------------------------
#####################################################################

# Frequency Span
record(ai, "$(P)$(R)Span-RB"){
  field(DESC, "Get frequency span")
  field(PREC, "1")
  field(EGU, "Hz")
  field(VAL, "700000")
}

record(ao, "$(P)$(R)Span-SP"){
  field(DESC, "Set frequency span")
  field(DRVH, "15")
  field(DRVL, "1")
  field(PREC, "1")
  field(EGU, "Hz")
  field(VAL, "700000")
}

# Center Frequency
record(ai, "$(P)$(R)CenterFreq-RB"){
  field(DESC, "Get center frequency")
  field(PREC, "1")
  field(EGU, "Hz")
  field(VAL, "119636695")
}

record(ao, "$(P)$(R)CenterFreq-SP"){
  field(DESC, "Set center frequency")
  field(DRVH, "3000000000")
  field(DRVL, "9000")
  field(PREC, "1")
  field(EGU, "Hz")
  field(VAL, "119636695")
}

# Reference Level
record(ai, "$(P)$(R)RefLvl-RB"){
  field(DESC, "Get reference power level")
  field(PREC, "1")
  field(EGU, "dBm")
  field(VAL, "0")
}

record(ao, "$(P)$(R)RefLvl-SP"){
  field(DESC, "Set reference power level")
  field(DRVH, "30")
  field(DRVL, "-130")
  field(PREC, "1")
  field(EGU, "dBm")
  field(VAL, "0")
}

# Start Frequency
record(ai, "$(P)$(R)StartFreq-RB"){
  field(DESC, "Get sweep start frequency")
  field(PREC, "1")
  field(EGU, "Hz")
  field(VAL, "119286695")
}

record(ao, "$(P)$(R)StartFreq-SP"){
  field(DESC, "Set sweep start frequency")
  field(DRVH, "7500000000")
  field(DRVL, "9000")
  field(PREC, "1")
  field(EGU, "Hz")
  field(VAL, "119286695")
  field(OUT, "$(P)$(R)StopFreq.DRVL PP")
  field(FLNK, "$(P)$(R)SweStepCalc")
}

record(calcout, "$(P)$(R)CalcStartFreq"){
  field(DESC, "Calculate sweep start frequency")
  field(INPA, "$(P)$(R)SweFreq")
  field(INPB, "$(P)$(R)SweSpan")
  field(CALC, "A-B/2")
  field(OUT, "$(P)$(R)StartFreq PP")
  field(FLNK, "$(P)$(R)StopFreqCalc")
}

# Stop Frequency
record(ai, "$(P)$(R)StopFreq-RB"){
  field(DESC, "Get sweep stop frequency")
  field(PREC, "1")
  field(EGU, "Hz")
  field(VAL, "119986695")
}

record(ao, "$(P)$(R)StopFreq-SP"){
  field(DESC, "Set sweep stop frequency")
  field(DRVH, "7500000000")
  field(DRVL, "9000")
  field(PREC, "1")
  field(EGU, "Hz")
  field(VAL, "119986695")
}

record(calcout, "$(P)$(R)CalcStopFreq"){
  field(DESC, "Calculate sweep stop frequency")
  field(INPA, "$(P)$(R)SweFreq")
  field(INPB, "$(P)$(R)SweSpan")
  field(CALC, "A+B/2")
  field(OUT, "$(P)$(R)StopFreq PP")
}

# Sweep Frequency
record(ai, "$(P)$(R)SweFreq-RB"){
  field(DESC, "Get center sweep frequency")
  field(PREC, "1")
  field(EGU, "Hz")
  field(VAL, "119636695")
  field(FLNK, "$(P)$(R)StartFreqCalc")
}

record(ao, "$(P)$(R)SweFreq-SP"){
  field(DESC, "Set center sweep frequency")
  field(PREC, "1")
  field(EGU, "Hz")
  field(VAL, "119636695")
  field(FLNK, "$(P)$(R)CalcStartFreq")
}

# Sweep Span
record(ai, "$(P)$(R)SweSpan-RB"){
  field(DESC, "Get span sweep frequency")
  field(PREC, "1")
  field(EGU, "Hz")
  field(VAL, "119986695")
  field(FLNK, "$(P)$(R)StartFreqCalc")
}

record(ao, "$(P)$(R)SweSpan-SP"){
  field(DESC, "Set span sweep frequency")
  field(PREC, "1")
  field(EGU, "Hz")
  field(VAL, "119986695")
  field(FLNK, "$(P)$(R)StartFreqCalc")

}
record(calcout, "$(P)$(R)StartFreqCalc"){
  field(DESC, "Start sweep frequency calc")
  field(INPA, "$(P)$(R)SweepFreq")
  field(INPB, "$(P)$(R)SweepSpan")
  field(CALC, "A-B/2")
  field(OUT, "$(P)$(R)StartFreq PP")
  field(FLNK, "$(P)$(R)StopFreqCalc")
}

record(calcout, "$(P)$(R)StopFreqCalc"){
  field(DESC, "Stop sweep frequency calc")
  field(INPA, "$(P)$(R)SweepFreq")
  field(INPB, "$(P)$(R)SweepSpan")
  field(CALC, "A+B/2")
  field(OUT, "$(P)$(R)StopFreq PP")
}

# Number of Sweep Points
record(ai, "$(P)$(R)SwePoints-RB"){
  field(DESC, "Get sweep points")
  field(PREC, "0")
  field(VAL, "25")
}

record(ao, "$(P)$(R)SwePoints-SP"){
  field(DESC, "Set Sweep points")
  field(DRVH, "1000")
  field(DRVL, "1")
  field(PREC, "0")
  field(VAL, "25")
  field(FLNK, "$(P)$(R)SweStepCalc")
}

# Sweep Frequency Step
record(calc, "$(P)$(R)SweStepCalc"){
  field(DESC, "Calculate sweep frequency step")
  field(INPA, "$(P)$(R)SwePoints")
  field(INPB, "$(P)$(R)SweSpan")
  field(CALC, "B/(A-1)")
  field(EGU, "Hz")
  field(PINI, "1")
}

# Resolution Bandwidth
record(ai, "$(P)$(R)Rbw-RB"){
  field(DESC, "Get resolution bandwidth")
  field(PREC, "1")
  field(EGU, "Hz")
  field(VAL, "100")
}

record(ao, "$(P)$(R)Rbw-SP"){
  field(DESC, "Set resolution bandwidth")
  field(DRVH, "15")
  field(DRVL, "1")
  field(PREC, "1")
  field(EGU, "Hz")
  field(VAL, "100")
}

# Enable/Disable Video Filter
record(bi, "$(P)$(R)EnblVbw-Sts"){
  field(DESC, "ON/OFF video filter")
  field(ZNAM, "OFF")
  field(ONAM, "ON")
}

record(bo, "$(P)$(R)EnblVbw-Sel"){
  field(DESC, "ON/OFF video filter")
  field(ZNAM, "OFF")
  field(ONAM, "ON")
}

# Video Resolution Bandwidth
record(ai, "$(P)$(R)Vbw-RB"){
  field(DESC, "Get video resolution bandwidth")
  field(PREC, "1")
  field(EGU, "Hz")
  field(VAL, "100")
}

record(ao, "$(P)$(R)Vbw-SP"){
  field(DESC, "Set video resolution bandwidth")
  field(DRVH, "15")
  field(DRVL, "1")
  field(PREC, "1")
  field(EGU, "Hz")
  field(VAL, "100")
}

# Trace Length
#Trace length: 801, 2401, 4001, 8001,10401, 16001, 32001, and 64001 points
record(longin, "$(P)$(R)TraceLenOpt-Sts") {
  field(DESC, "Trace length")
}

record(mbbo, "$(P)$(R)TraceLenOpt-Sel") {
  field(DESC, "Trace length")
  field(ZRVL, "801")
  field(ZRST, "801")
  field(ONVL, "2401")
  field(ONST, "2401")
  field(TWVL, "4001")
  field(TWST, "4001")
  field(THVL, "8001")
  field(THST, "8001")
  field(FRVL, "10401")
  field(FRST, "10401")
  field(FVVL, "16001")
  field(FVST, "16001")
  field(SXVL, "32001")
  field(SXST, "32001")
  field(SVVL, "64001")
  field(SVST, "64001")
}

# Initiate Spectrum Acquisition
record(bo, "$(P)$(R)GetSpec-Cmd"){
  field(DESC, "Initiate spectrum acquisition")
}

# Initiate Sweep Spectrum Acquisition
record(bo, "$(P)$(R)InitSwe-Cmd"){
  field(DESC, "Initiate sweep spectrum acquisition")
}

# Amplitude Data
record(waveform, "$(P)$(R)TraceAmp-Mon") {
  field(DESC, "Spectrum trace amplitude data")
  field(NELM, "64001")
  field(FTVL, "FLOAT")
  field(EGU, "dBm")
}

# Frequency Data
record(waveform, "$(P)$(R)TraceFreq-Mon") {
  field(DESC, "Spectrum trace frequency data")
  field(NELM, "64001")
  field(FTVL, "DOUBLE")
  field(EGU, "Hz")
}

# Amplitude Peak
record(waveform, "$(P)$(R)PeakAmp-Mon") {
  field(DESC, "Spectrum peak amplitude data")
  field(NELM, "2")
  field(FTVL, "FLOAT")
  field(EGU, "dBm")
}

# Frequency Peak 
record(waveform, "$(P)$(R)PeakFreq-Mon") {
  field(DESC, "Spectrum peak frequency data")
  field(NELM, "2")
  field(FTVL, "DOUBLE")
  field(EGU, "MHz")
}

# Sweep Amplitude Data
record(waveform, "$(P)$(R)SweAmpData-Mon") {
  field(DESC, "Sweep amplitude data")
  field(NELM, "1000")
  field(FTVL, "FLOAT")
  field(EGU, "dBm")
}

# Sweep Frequency Data
record(waveform, "$(P)$(R)SweFreqData-Mon") {
  field(DESC, "Sweep frequency data")
  field(NELM, "1000")
  field(FTVL, "DOUBLE")
  field(EGU, "Hz")
}

# Tune Measurement
record(waveform, "$(P)$(R)TuneMeas-Mon") {
  field(DESC, "Tune measurement")
  field(NELM, "2")
  field(FTVL, "DOUBLE")
  field(PREC, "6")
  field(EGU, "MHz")
}

# Delta Between Peaks
record(ai, "$(P)$(R)TuneDelta-Mon"){
  field(DESC, "Tune delta point between peaks")
  field(PREC, "0")
}

# Reference Frequency for Tune Measurement
record(ai, "$(P)$(R)TuneFreq-Mon"){
  field(DESC, "Get tune reference frequency")
  field(PREC, "6")
  field(EGU, "MHz")
}

record(ai, "$(P)$(R)TuneFreq-Mon"){
  field(DESC, "Set tune reference frequency")
  field(PREC, "6")
  field(EGU, "MHz")
}

# Enable/Disable Signal Path Auto Attenuation
record(bi, "$(P)$(R)EnblAutoAtt-Sts"){
  field(DESC, "Get signal path auto-attenuation state")
  field(ZNAM, "OFF")
  field(ONAM, "ON")
}

record(bo, "$(P)$(R)EnblAutoAtt-Sel"){
  field(DESC, "ON/OFF signal path auto-attenuation")
  field(ZNAM, "OFF")
  field(ONAM, "ON")
}

# Input Attenuation Value
record(ai, "$(P)$(R)InAtt-RB"){
  field(DESC, "Get RF input attenuator")
  field(PREC, "0")
  field(EGU, "dB")
  field(VAL, "0")
}

record(ao, "$(P)$(R)InAtt-SP"){
  field(DESC, "Set RF input attenuator")
  field(DRVH, "0")
  field(DRVL, "-51")
  field(PREC, "0")
  field(EGU, "dB")
  field(VAL, "0")
}


# Input Preamplifier Value
record(bi, "$(P)$(R)EnblPreAmp-Sts"){
  field(DESC, "Get RF preamplifier state")
  field(ZNAM, "OFF")
  field(ONAM, "ON")
}

record(bo, "$(P)$(R)EnblPreAmp-Sel"){
  field(DESC, "ON/OFF RF Preamplifier")
  field(ZNAM, "OFF")
  field(ONAM, "ON")
}

# Aquisition Time
record(ai, "$(P)$(R)AcqTime-Mon"){
  field(DESC, "Get acquisition rate")
  field(PREC, "3")
  field(EGU, "ms")
}

# Device ID (found by the Search function)
record(ai, "$(P)$(R)DevID-RB"){
  field(DESC, "Get device number to connect to")
  field(PREC, "0")
  field(VAL, "$(DEVICE)")
}

record(ai, "$(P)$(R)DevID-Mon"){
  field(DESC, "Set device number to connect to")
  field(PREC, "0")
  field(VAL, "$(DEVICE)")
}

